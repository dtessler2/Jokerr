<!DOCTYPE html>
<html>
<head>
    <title>Jokerr</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'chatbot/styles.css' %}">
</head>
<body>
{% csrf_token %}
<script>
    function getCSRFToken() {
        let cookieValue = null;
        const name = "csrftoken";
        if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + "=")) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
<div class="chat-container">
    <h1>Jokerr</h1>
    <div class="chat-box" id="chat-box">
        <!-- Chat messages will be appended here -->
    </div>

    <div class="input-box">
        <input type="text" id="user-input" placeholder="Select a category" autocomplete="off">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    function sendMessage() {
        const userInput = document.getElementById("user-input");
        const message = userInput.value.trim();

        if (message) {
            appendMessage("You", message);
            userInput.value = "";

            fetch("/chatbot/chat/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ message: message }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log("Response data:", data);  // Check the response structure
                    if (data.reply) {
                        appendMessage("Bot", data.reply);
                    } else if (data.error) {
                        appendMessage("Bot", data.error);
                    }
                })
                .catch(error => {
                    console.log("Error:", error);
                    appendMessage("Bot", "Something went wrong. Try again.");
                });
        }
    }

    function appendMessage(sender, text) {
        const chatBox = document.getElementById("chat-box");
        const messageElement = document.createElement("div");
        messageElement.className = "message " + sender.toLowerCase();
        messageElement.textContent = sender + ": " + text;
        chatBox.appendChild(messageElement);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>
</body>
</html>